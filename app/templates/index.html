  <!DOCTYPE html>
  <html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Deletor Automático · Content Server</title>
    <meta name="color-scheme" content="dark light">
    <script type="text/javascript" src="../static/index.js" defer></script>
    <style>
      /* ====== Design tokens ====== */
      :root{
        --bg: #0b0b0c;
        --bg-accent: radial-gradient(1200px 700px at 12% -10%, #2e3a52 0%, transparent 55%),
                    radial-gradient(1000px 640px at 110% -10%, #4b2f3a 0%, transparent 55%),
                    #0b0b0c;
        --panel: rgba(20,20,22,.78);
        --panel-strong: rgba(28,28,32,.78);
        --panel-soft: rgba(255,255,255,.04);
        --border: rgba(255,255,255,.12);
        --border-strong: rgba(255,255,255,.18);
        --text: #f5f5f7;
        --muted: #a1a1a6;
        --brand: #1790ff;
        --brand-strong:#0f6ed1;
        --ok:#20c77a;
        --warn:#ffb020;
        --danger:#ff4d4f;
        --radius-xl: 24px; --radius-lg: 16px; --radius-md: 12px; --radius-sm:10px;
        --shadow: 0 30px 70px rgba(0,0,0,.55), 0 2px 8px rgba(0,0,0,.28);
        --glass: saturate(1.1) blur(16px);
        --focus: 0 0 0 4px rgba(23,144,255,.18), 0 0 0 1px var(--brand);
        --font:-apple-system,BlinkMacSystemFont,"SF Pro Text","Inter",system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      }
      @media (prefers-color-scheme: light){
        :root{
          --bg: #f5f5f7;
          --bg-accent: radial-gradient(1000px 600px at -10% -10%, #eaf1ff 0%, transparent 55%),
                      radial-gradient(1000px 640px at 110% -10%, #ffeaf1 0%, transparent 55%),
                      #f5f5f7;
          --panel: rgba(255,255,255,.86);
          --panel-strong: rgba(255,255,255,.94);
          --panel-soft: rgba(0,0,0,.03);
          --border: rgba(0,0,0,.08);
          --border-strong: rgba(0,0,0,.12);
          --text: #1d1d1f; --muted:#6e6e73;
          --shadow: 0 30px 70px rgba(0,0,0,.10), 0 2px 8px rgba(0,0,0,.06);
          --focus: 0 0 0 5px rgba(23,144,255,.20);
        }
      }

      /* ====== Base ====== */
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0; font: 15.5px/1.6 var(--font); color:var(--text); background: var(--bg-accent);
        -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }
      ::selection{background: rgba(23,144,255,.35); color:#fff}

      /* ====== Topbar ====== */
      .topbar{ position: fixed; inset: 16px 16px auto 16px; height:56px; display:flex; align-items:center; gap:12px; padding:10px 14px; background: var(--panel); border:1px solid var(--border); backdrop-filter: var(--glass); border-radius: 16px; box-shadow: var(--shadow); z-index: 10 }
      .dot{width:12px;height:12px;border-radius:50%; background: linear-gradient(135deg, var(--brand), #7ab8ff); box-shadow: 0 0 0 5px rgba(23,144,255,.12)}
      .brand{font-weight:700; letter-spacing:.2px}

      /* ====== Layout ====== */
      .wrap{min-height:100%; display:flex; align-items:center; justify-content:center; padding:112px 20px 72px}
      .card{ width:min(1120px, 96vw); background: var(--panel); border:1px solid var(--border); border-radius: var(--radius-xl); box-shadow: var(--shadow); backdrop-filter: var(--glass); overflow:hidden; animation: up .45s ease both }
      @keyframes up{from{opacity:0; transform: translateY(10px)} to{opacity:1; transform:none}}

      /* ====== Stepper ====== */
      .stepper{ padding:18px 22px; border-bottom:1px solid var(--border); background: var(--panel-strong) }
      .steps{ list-style:none; margin:0; padding:0; display:flex; gap:14px; flex-wrap:wrap; align-items:center }
      .step{ display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:999px; border:1px solid var(--border); background: var(--panel-soft); font-size:.92rem; color:var(--muted) }
      .step.current{ color:var(--text); border-color: var(--border-strong) }
      .step.done{ color:#cde9ff; background: rgba(23,144,255,.10); border-color: rgba(23,144,255,.22) }
      .step .num{ width:18px; height:18px; border-radius:50%; display:grid; place-items:center; font-size:.78rem; background:rgba(255,255,255,.08) }
      .step.done .num{ background: linear-gradient(135deg, var(--brand), #7ab8ff); color:#fff }
      .stepbar{ position:relative; height:3px; background: var(--panel-soft); border-radius:999px; margin-top:14px; overflow:hidden }
      .stepbar-fill{ position:absolute; inset:0; width:0%; height:100%; background: linear-gradient(90deg, var(--brand), #7ab8ff) }

      /* ====== Grid ====== */
      .grid{display:grid; grid-template-columns: 1.05fr 1fr; gap:28px; padding:28px}
      @media (max-width: 980px){ .grid{grid-template-columns:1fr; gap:22px; padding:22px} }

      h1.title{font-size: clamp(24px,4.2vw,38px); line-height:1.14; margin:0 0 8px; font-weight:800}
      .subtitle{color:var(--muted); font-size:1.02rem; margin:0 0 16px}

      .pills{display:flex; flex-wrap:wrap; gap:10px}
      .pill{border:1px solid var(--border); background: var(--panel-strong); padding:8px 12px; border-radius:999px; font-size:.9rem; display:inline-flex; align-items:center; gap:8px}

      /* ====== Upload panel ====== */
      .panel{background: var(--panel-strong); border:1px solid var(--border); border-radius: var(--radius-lg); padding:18px}
      .drop{ position:relative; border:2px dashed var(--border); border-radius: var(--radius-lg); padding:28px 20px; text-align:center; transition: border-color .2s ease, box-shadow .2s ease, transform .06s ease; background: linear-gradient(180deg, transparent, var(--panel-soft)); cursor: pointer; outline: none }
      .drop:hover{transform: translateY(-1px)}
      .drop.drag{border-color: var(--brand); box-shadow: 0 0 0 8px rgba(23,144,255,.12)}
      .drop:focus-visible{box-shadow: var(--focus)}
      .drop input[type=file]{position:absolute; inset:0; opacity:0; cursor:pointer}
      .drop h3{margin:6px 0 2px; font-size:1.05rem}
      .drop p{margin:0; color:var(--muted); font-size:.92rem}

      .meta{display:flex; align-items:center; justify-content:center; gap:10px; margin-top:14px}
      .chip{ display:none; align-items:center; gap:10px; padding:10px 12px; border-radius: 12px; border:1px solid var(--border-strong); background: rgba(23,144,255,.10); font-size:.92rem }
      .chip.show{display:inline-flex}
      .chip.error{background: rgba(255,77,79,.1); color:#ffd7d7}

      .actions{display:flex; gap:10px; margin-top:14px; justify-content:center; flex-wrap:wrap}
      .btn{ appearance:none; border:none; cursor:pointer; user-select:none; background: var(--brand); color:#fff; font-weight:700; letter-spacing:.2px; padding: 11px 18px; border-radius: 999px; font-size:.96rem; transition: transform .06s ease, box-shadow .2s ease, background .2s ease; box-shadow: 0 12px 24px rgba(23,144,255,.28) }
      .btn:hover{background: var(--brand-strong)}
      .btn:active{transform: translateY(1px)}
      .btn[disabled]{opacity:.6; cursor:not-allowed; box-shadow:none}
      .btn.secondary{background: transparent; color: var(--text); border:1px solid var(--border); box-shadow:none}
      .btn.secondary:hover{background: var(--panel-soft)}
      .btn:focus-visible{box-shadow: var(--focus)}

      .progress{position:relative; height:3px; background: var(--panel-soft); border-radius: 999px; overflow:hidden; margin-top:10px; display:none}
      .progress .bar{position:absolute; inset:0; width:0%; height:100%; background: linear-gradient(90deg, var(--brand), #7ab8ff)}

      /* ====== Preview ====== */
      .tile{background: var(--panel-strong); border:1px solid var(--border); border-radius: var(--radius-md); padding:16px}
      .tile h4{margin:4px 0 10px; font-size:1rem}
      .table-wrap{overflow:auto; max-height:220px; border:1px dashed var(--border); border-radius: 12px}
      table{width:100%; border-collapse:collapse; font-size:.92rem}
      thead th{position:sticky; top:0; background:var(--panel); border-bottom:1px solid var(--border-strong); text-align:left; padding:10px}
      tbody td{padding:8px 10px; border-bottom:1px solid var(--border); white-space:nowrap; text-overflow:ellipsis; overflow:hidden}
      tbody tr:nth-child(odd){background: var(--panel-soft)}

      /* ====== Mapper ====== */
      .mapper{ display:none; gap:16px; margin-top:14px }
      .cols, .targets{ flex:1 }
      .cols{ display:flex; flex-wrap:wrap; gap:8px }
      .col-chip{ padding:8px 10px; border:1px solid var(--border); background: var(--panel-soft); border-radius:10px; cursor:grab; user-select:none }
      .col-chip[aria-grabbed="true"]{ box-shadow: 0 0 0 6px rgba(23,144,255,.12); border-color: var(--brand) }
      .target{ border:1.2px dashed var(--border); background:var(--panel-soft); border-radius:12px; padding:12px; display:flex; align-items:center; justify-content:space-between; gap:10px; min-height:52px }
      .target.filled{ border-style:solid; border-color: var(--border-strong) }
      .target .label{ font-weight:700 }
      .target .req{ color: var(--muted); font-weight:600; margin-left:6px }
      .pick{ min-width: 180px }
      .map-note{ color:var(--muted); font-size:.88rem; margin-top:6px }
      .mapper-row{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:8px }

      /* ====== Validation panel ====== */
      .validate-panel{ display:none; gap:10px; margin-top:14px }
      .kpi{ flex:1; padding:12px; border-radius:12px; border:1px solid var(--border); background: var(--panel-strong); display:flex; align-items:center; justify-content:space-between }
      .kpi strong{ font-size:1.1rem }

      .foot{color:var(--muted); text-align:center; font-size:.88rem; padding: 0 26px 26px}
      @media (prefers-reduced-motion: reduce){ *{animation:none!important; transition:none!important} }
      /* ====== Modal (Login) ====== */
      .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:50 }
      .modal.show{ display:flex }
      .backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.45); backdrop-filter: blur(2px) }
      .sheet{ position:relative; width:min(520px, 94vw); background: var(--panel-strong); border:1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); padding:18px 18px 16px }
      .sheet h3{ margin:0 0 6px }
      .field{ display:grid; grid-template-columns: 120px 1fr; gap:12px; align-items:center; margin-top:10px }
      .field label{ color:var(--muted); font-size:.92rem }
      .input{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border); background:var(--panel); color:var(--text) }
      .row{ display:flex; gap:10px; justify-content:flex-end; margin-top:14px }
      .hint{ color:var(--muted); font-size:.88rem; margin-top:8px }
      .error-text{ color: var(--danger); font-size:.9rem; display:none; margin-top:8px }
  </style>
  </head>
  <body>
    <header class="topbar" role="banner">
      <span class="dot" aria-hidden="true"></span>
      <strong class="brand">Deletor Automático</strong>
      <span id="authBadge" class="pill" style="margin-left:auto">Desconectado</span>
      <button id="btnLogin" class="btn secondary" type="button" style="padding:8px 12px; font-size:.9rem">Conectar</button>
    </header>

    <main class="wrap">
      <section class="card" aria-labelledby="title">
        <div class="stepper" aria-label="Etapas">
          <ol class="steps" id="steps">
            <li class="step current" data-step="upload"><span class="num">1</span>Upload</li>
            <li class="step" data-step="map"><span class="num">2</span>Mapeamento</li>
            <li class="step" data-step="validate"><span class="num">3</span>Validação</li>
            <li class="step" data-step="run"><span class="num">4</span>Execução</li>
            <li class="step" data-step="done"><span class="num">5</span>Concluído</li>
          </ol>
          <div class="stepbar"><div class="stepbar-fill" id="stepbar"></div></div>
        </div>

        <div class="grid">
          <!-- Texto -->
          <div>
            <h1 id="title" class="title">Exclusões por lote, com controle.</h1>
            <p class="subtitle">CSV → mapeamento → validação → execução.</p>
            <div class="pills" aria-hidden="true">
              <span class="pill">Cabeçalho detectado</span>
              <span class="pill">Mapeamento assistido</span>
              <span class="pill">Progresso em tempo real</span>
            </div>
          </div>

          <!-- Painel principal -->
          <form class="panel" id="uploadForm" action="/upload" method="POST" enctype="multipart/form-data" novalidate>
            <!-- Upload -->
            <div class="drop" id="drop" role="button" tabindex="0" aria-controls="preview" aria-describedby="dropHelp">
              <input id="file" name="file" type="file" accept=".csv" aria-label="Selecionar arquivo CSV">
              <svg width="44" height="44" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M14 3H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8l-5-5z" stroke="currentColor" stroke-width="1.2"/>
                <path d="M14 3v5h5" stroke="currentColor" stroke-width="1.2"/>
              </svg>
              <h3>Selecione o CSV</h3>
              <p id="dropHelp">ou arraste para aqui</p>
            </div>

            <div class="meta">
              <div class="chip" id="chip"><span id="chipText">Nenhum arquivo selecionado</span></div>
            </div>

            <div class="actions">
              <button class="btn" id="btnValidate" type="button" disabled>Validar</button>
              <button class="btn" id="btnExecute" type="button" disabled>Executar</button>
              <a class="btn secondary" href="/static/template.csv" download>Template</a>
            </div>

            <div class="progress" id="progress"><div class="bar" id="bar"></div></div>

            <!-- Prévia -->
            <div class="tile" id="preview" style="display:none; margin-top:14px">
              <h4>Prévia</h4>
              <div class="table-wrap">
                <table aria-label="Prévia do CSV">
                  <thead id="thead"></thead>
                  <tbody id="tbody"></tbody>
                </table>
              </div>
            </div>

            <!-- Mapper -->
            <div class="mapper" id="mapper">
              <div class="cols" id="cols"></div>
              <div class="targets">
                <div class="mapper-row">
                  <div class="target" data-key="username">
                    <div>
                      <div class="label">Usuário<span class="req">*</span></div>
                      <div class="map-note">Ex.: username, user, login</div>
                    </div>
                    <select class="pick" id="pick-username"></select>
                  </div>
                  <div class="target" data-key="id">
                    <div>
                      <div class="label">ID<span class="req">*</span></div>
                      <div class="map-note">Ex.: id, user_id</div>
                    </div>
                    <select class="pick" id="pick-id"></select>
                  </div>
                </div>
                <div class="mapper-row">
                  <div class="target" data-key="email">
                    <div>
                      <div class="label">E-mail</div>
                      <div class="map-note">Opcional</div>
                    </div>
                    <select class="pick" id="pick-email"></select>
                  </div>
                  <div class="target" data-key="origin">
                    <div>
                      <div class="label">Origem</div>
                      <div class="map-note">Opcional (sistema/nota)</div>
                    </div>
                    <select class="pick" id="pick-origin"></select>
                  </div>
                </div>
              </div>
            </div>

            <!-- Painel de validação -->
            <div class="validate-panel" id="validatePanel">
              <div class="kpi"><span>Linhas</span><strong id="kTotal">—</strong></div>
              <div class="kpi"><span>Válidas</span><strong id="kValid">—</strong></div>
              <div class="kpi"><span>Inválidas</span><strong id="kInvalid">—</strong></div>
            </div>

            <p class="sr" id="srStatus" aria-live="polite" aria-atomic="true" style="position:absolute;left:-9999px">Status</p>
          </form>
        </div>

        <p class="foot">© <span id="year"></span> Deletor Automático</p>
      </section>
    </main>

    <!-- Login Modal -->
    <section class="modal" id="loginModal" aria-hidden="true" role="dialog" aria-labelledby="loginTitle">
      <div class="backdrop" data-close="modal"></div>
      <div class="sheet">
        <h3 id="loginTitle">Conectar ao Content Server</h3>
        <p class="hint">As credenciais são enviadas ao servidor; o ticket é salvo no <code>.env</code> do backend.</p>
        <div class="field">
          <label for="inUser">Usuário</label>
          <input id="inUser" class="input" autocomplete="username" placeholder="seu.usuario" />
        </div>
        <div class="field">
          <label for="inPass">Senha</label>
          <input id="inPass" class="input" type="password" autocomplete="current-password" placeholder="••••••••" />
        </div>
        <div class="field">
          <label for="inEnv">Ambiente</label>
          <input id="inEnv" class="input" placeholder="https://otcs.g115-test.opentext.cloud/cs/cs" />
        </div>
        <div class="error-text" id="loginErr"></div>
        <div class="row">
          <button class="btn secondary" type="button" data-close="modal">Cancelar</button>
          <button class="btn" type="button" id="doLogin">Entrar</button>
        </div>
      </div>
    </section>



  </body>
  </html>
